<view class="container">
  <image class="page-bg" src="/images/bg_campus.png" mode="aspectFill"></image>

  <view class="user-pill" bindtap="navigateToPage" data-url="/pages/user/user">
    <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
    <view class="user-meta">
      <text class="nickname-text">{{userInfo.nickName}}</text>
      <view class="score-tag">{{userInfo.points}} 积分</view>
    </view>
  </view>

  <view class="panda-interaction">
    <text>熊猫数字人互动</text>
    <image class="panda-mini" src="/images/icon-panda-face.png"></image>
  </view>

  <view class="aqi-floater" bindtap="onOpenAQI">
    <view class="aqi-circle">
      <text class="aqi-label">{{aqiLevel}}</text>
      <text class="aqi-num">{{aqiValue}}</text>
      <text class="aqi-desc">{{currentCity}}</text>
    </view>
  </view>

  <view class="top-nav-row">
    <block wx:for="{{topNavList}}" wx:key="name">
      <view class="nav-btn" bindtap="navigateToPage" data-url="{{item.url}}">
        <image class="nav-btn-icon" src="{{item.icon}}"></image>
        <text>{{item.name}}</text>
      </view>
    </block>
  </view>

  <view class="bottom-panel">
    
    <view class="left-panel">
      <view class="panel-header">
        <image class="header-icon" src="/images/icon-leaf-check.png"></image>
        <text class="header-title">低碳行为</text>
      </view>
      
      <scroll-view scroll-y class="behavior-list" type="list">
        <view wx:if="{{todayBehaviors.length === 0}}" class="empty-tip">今日暂无记录</view>
        <block wx:for="{{todayBehaviors}}" wx:key="time">
          <view class="behavior-item">
            <view class="behavior-time">{{item.time}}</view>
            <view class="behavior-content">
              <text class="action-name">{{item.task_name}}</text>
              <text class="points-add">+{{item.points_earned}}</text>
            </view>
          </view>
        </block>
      </scroll-view>
    </view>

    <view class="right-panel">
      
      <view class="badge-item badge-blue" bindtap="onTapFeature" data-name="低碳文教">
        <text>低碳</text><text>常识</text>
      </view>

      <view class="badge-item badge-cyan" bindtap="onTapFeature" data-name="蓉城地图">
        <text>低碳</text><text>挑战</text>
      </view>

      <view class="badge-item badge-orange" bindtap="onTapFeature" data-name="赚积分">
        <text>轻松</text><text>赚积分</text>
      </view>

    </view>

    <view class="mall-entry" bindtap="onTapFeature" data-name="兑换中心">
      <image class="mall-img" src="/images/icon-mall-basket.png"></image>
      <text class="mall-title">兑换中心</text>
    </view>
  </view>

  <view class="aqi-modal-mask" wx:if="{{showAQIModal}}" bindtap="onCloseAQI">
    <view class="aqi-modal-content" catchtap="return"> 
      
      <view class="modal-header">
        <text class="modal-title">{{currentCity}}空气趋势</text>
        <view class="close-btn" bindtap="onCloseAQI">×</view>
      </view>

      <view class="detail-grid">
        <view class="grid-item"><text class="grid-val">{{aqiDetails.pm25}}</text><text class="grid-label">PM2.5</text></view>
        <view class="grid-item"><text class="grid-val">{{aqiDetails.pm10}}</text><text class="grid-label">PM10</text></view>
        <view class="grid-item"><text class="grid-val">{{aqiDetails.no2}}</text><text class="grid-label">NO₂</text></view>
        <view class="grid-item"><text class="grid-val">{{aqiDetails.so2}}</text><text class="grid-label">SO₂</text></view>
      </view>

      <view class="chart-section">
        <text class="section-title">未来7天空气预测</text>
        <view class="chart-box">
          <ec-canvas id="mychart-dom-line" canvas-id="mychart-line" ec="{{ ec }}"></ec-canvas>
        </view>
      </view>

      <view class="analysis-box">
        <view class="analysis-tag">分析</view>
        <text class="analysis-text">根据气象大数据分析，未来一周{{currentCity}}空气质量持续优良，无明显污染过程，非常适宜户外运动和开窗通风。</text>
      </view>

    </view>
  </view>

</view>